
<!doctype html>
<html>
	<head>
		<!--
			Original code by mrdoob
			http://www.mrdoob.com/projects/chromeexperiments/google-gravity/2013.html

			This code modified by @wellcaffeinated http://wellcaffeinated.net
		-->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<title>Google Gravity | PhysicsJS</title> 
		<style>

			body {
				margin:0;
				padding:0;
				overflow: visible!important;
			}


			.div {
				width:50px;
				height:50px;
				background:black;
				margin:20px;
			}
		</style>
	</head>
	<body>




		<div id="content">
			
			<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>
<div class="physics-element div"></div>

			
		</div>


		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<script src="http://wellcaffeinated.net/PhysicsJS/examples/physicsjs-full.js"></script>
		<script>

			
			var h = document.body.clientHeight;

			/**
			 * Original code by mrdoob
			 * http://www.mrdoob.com/projects/chromeexperiments/google-gravity/2013.html
			 *
			 * This code modified by @wellcaffeinated http://wellcaffeinated.net
			 */

			var delta = [ 0, 0 ];
			var stage = [ window.screenX, window.screenY, window.innerWidth, document.body.clientHeight ];
			getBrowserDimensions(h);

			var isRunning = false;
			var isMouseDown = false;

			var worldAABB;
			var world;
			var edgeBounce;
			var iterations = 16;
			var timeStep = 1000 / 260; 

			var constraints;
			var mouseJoint;
			var mouse = { x: 0, y: 0 };

			var mouseOnClick = [];

			var elements = [];
			var bodies = [];
			var properties = [];

			var resultBodies = [];

			var gravity = { x: 0, y: 1 };
			var gravityBehavior;



			$(document).on("keyup",function(){
				init();
			})


			function init() {

			


				// init PhysicsJS

				worldAABB = Physics.aabb.apply(null, stage);

				world = Physics({
					timestep: timeStep,
					maxIPF: iterations
				});

				// walls
				edgeBounce = Physics.behavior('edge-collision-detection', {
	                aabb: worldAABB,
	                restitution: 0.4,
	                cof: 0.5
	            });
	            world.add( edgeBounce );

	            world.add( Physics.behavior('body-collision-detection', { checkAll: false }) );
		        world.add( Physics.behavior('sweep-prune') );
		        world.add( Physics.behavior('body-impulse-response') );

		        // constraints
		        constraints = Physics.behavior('verlet-constraints', {
                    iterations: 2
                });
                world.add( constraints );

		        // add gravity
		        gravityBehavior = Physics.behavior('constant-acceleration', { acc: gravity });
        		world.add( gravityBehavior );

				// Get physics-element elements

				elements = $("physics-element");

				for ( var i = 0; i < elements.length; i ++ ) {

					properties[i] = getElementProperties( elements[i] );

				}

				for ( var i = 0; i < elements.length; i ++ ) {

					var element = elements[ i ];
					element.style.position = 'absolute';
					element.style.left = ( - properties[i][2]/2) + 'px'; // will be set by renderer
					element.style.top = ( - properties[i][3]/2) + 'px';
					element.style.width = properties[i][2] + 'px';
					// 

					bodies[i] = Physics.body('convex-polygon', {
						x: properties[i][0] + properties[i][2]/2,
						y: properties[i][1] + properties[i][3]/2,
						vertices: [
							{ x: 0, y: 0 },
							{ x: properties[i][2], y: 0 },
							{ x: properties[i][2], y: properties[i][3] },
							{ x: 0, y: properties[i][3] }
						]
					});
					bodies[i].view = element;

					// Clean position dependencies

					while ( element.offsetParent ) {

						element = element.offsetParent;
						element.style.position = 'static';

					}

				}

				// add the bodies to the world
				world.add( bodies );
				// renderer
	            var renderer = Physics.renderer('dom', {
		            el: document.body,
		            width: window.innerWidth,
		            height: document.body.clientHeight,
		        });
				world.add( renderer );
				// position the views
				world.render();
				world.pause();

				Physics.util.ticker.subscribe( loop );
				Physics.util.ticker.start();

				// magic to trigger GPU
				world.subscribe('render', function( data ){
					var style;
					for ( var i = 0, l = data.bodies.length; i < l; ++i ){
						
						style = data.bodies[ i ].view.style;
						style.WebkitTransform += ' translateZ(0)';
						style.MozTransform += ' translateZ(0)';
						style.MsTransform += ' translateZ(0)';
						style.transform += ' translateZ(0)';
					}
				});

				world.unpause();
			}

			

			

			

			//

			function loop( time ) {

				if (getBrowserDimensions())
					setWalls();

				delta[0] += (0 - delta[0]) * .5;
				delta[1] += (0 - delta[1]) * .5;

				gravityBehavior.setAcceleration({ 
					x: gravity.x * 5e-4 + delta[0], 
					y: gravity.y * 5e-4 + delta[1]
				});

				
				world.step( time );
				// only render if not paused
	            if ( !world.isPaused() ){
	                world.render();
	            }
			}


			function setWalls() {

				worldAABB = Physics.aabb.apply(null, stage);
            	edgeBounce.setAABB( worldAABB );

			}

			// .. UTILS

			function getElementsByClass( searchClass ) {

				var classElements = [];
				var els = document.getElementsByTagName('*');
				var elsLen = els.length

				for (i = 0, j = 0; i < elsLen; i++) {

					var classes = els[i].className.split(' ');
					for (k = 0; k < classes.length; k++)
						if ( classes[k] == searchClass )
							classElements[j++] = els[i];
				}

				return classElements;
			}

			function getElementProperties( element ) {

				var x = 0;
				var y = 0;
				var width = element.offsetWidth;
				var height = element.offsetHeight;
				
				do {
					
					x += element.offsetLeft;
					y += element.offsetTop;

				} while ( element = element.offsetParent );

				return [ x, y, width, height ];
			}

			function getBrowserDimensions(h) {

				var changed = false;

				if ( stage[0] != window.screenX ) {

					delta[0] = (window.screenX - stage[0]) * 50;
					stage[0] = window.screenX;
					changed = true;
				}

				if ( stage[1] != window.screenY ) {

					delta[1] = (window.screenY - stage[1]) * 50;
					stage[1] = window.screenY;
					changed = true;
				}

				if ( stage[2] != window.innerWidth ) {

					stage[2] = window.innerWidth;
					changed = true;
				}

				if ( stage[3] != window.innerHeight ) {

					stage[3] = 2000
					changed = true;
				}

				return changed;
			}

		</script>

	</body>
</html>